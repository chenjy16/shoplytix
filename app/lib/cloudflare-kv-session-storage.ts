import{jsx as e,jsxs as o}from"react/jsx-runtime";import{RemixServer as z,Meta as K,Links as V,Outlet as O,ScrollRestoration as W,Scripts as E,LiveReload as Y,useLoaderData as k,Link as A,NavLink as H}from"@remix-run/react";import{isbot as U}from"isbot";import{renderToReadableStream as J}from"react-dom/server";import{shopifyApp as q}from"@shopify/shopify-app-remix";import{restResources as X}from"@shopify/shopify-api/rest/admin/2023-10";import{json as N,redirect as Z}from"@remix-run/cloudflare";import{useState as G,useRef as P,useEffect as j}from"react";const $=5e3;async function Q(a,n,t,i,c){const l=new AbortController,r=setTimeout(()=>l.abort(),$),s=await J(e(z,{context:i,url:a.url,abortDelay:$}),{signal:l.signal,onError(h){l.signal.aborted||console.error(h),n=500}});return s.allReady.then(()=>clearTimeout(r)),U(a.headers.get("user-agent")||"")&&await s.allReady,t.set("Content-Type","text/html"),new Response(s,{headers:t,status:n})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"})),te="/assets/tailwind-BJw-yZ-q.css",ae=()=>[{rel:"stylesheet",href:te}];function re(){return o("html",{lang:"zh-CN",children:[o("head",{children:[e("meta",{charSet:"utf-8"}),e("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),e(K,{}),e(V,{})]}),o("body",{children:[e(O,{}),e(W,{}),e(E,{}),e(Y,{})]})]})}const se=Object.freeze(Object.defineProperty({__proto__:null,default:re,links:ae},Symbol.toStringTag,{value:"Module"}));class oe{constructor(n,t="shopify_session:"){this.namespace=n,this.prefix=t}async storeSession(n){try{const t=this.prefix+n.id;return await this.namespace.put(t,JSON.stringify(n),{expirationTtl:60*60*24*7}),!0}catch(t){return console.error("Failed to store session:",t),!1}}async loadSession(n){try{const t=this.prefix+n,i=await this.namespace.get(t);return i?JSON.parse(i):void 0}catch(t){console.error("Failed to load session:",t);return}}async deleteSession(n){try{const t=this.prefix+n;return await this.namespace.delete(t),!0}catch(t){return console.error("Failed to delete session:",t),!1}}async deleteSessions(n){try{const t=n.map(i=>this.deleteSession(i));return await Promise.all(t),!0}catch(t){return console.error("Failed to delete sessions:",t),!1}}async findSessionsByShop(n){try{const{keys:t}=await this.namespace.list({prefix:this.prefix}),i=[];for(const c of t){const l=await this.namespace.get(c.name);if(l){const r=JSON.parse(l);r.shop===n&&i.push(r)}}return i}catch(t){return console.error("Failed to find sessions by shop:",t),[]}}}const ne=({env:a})=>{const n=a.SHOPIFY_KV_NAMESPACE;if(!n)throw new Error("SHOPIFY_KV_NAMESPACE environment variable is required");console.log("初始化 Shopify 配置");let t;return t=q({apiKey:a.SHOPIFY_API_KEY||"",apiSecretKey:a.SHOPIFY_API_SECRET||"",scopes:["read_products","write_products","read_orders","write_orders","read_customers","read_analytics"],appUrl:a.SHOPIFY_APP_URL||"",shopifyApiVersion:"2025-04",sessionStorage:new oe(n),distribution:"app",restResources:X,webhooks:{APP_UNINSTALLED:{deliveryMethod:"https",callbackUrl:"/api/webhooks"}},hooks:{afterAuth:async({session:i,request:c,response:l})=>{console.log("授权成功，执行 afterAuth 钩子"),t.registerWebhooks({session:i});const r=new URL(c.url).searchParams.get("host"),s=i.shop;return console.log(`重定向到应用主页: /app?shop=${s}&host=${r}`),l.redirect(`/app?shop=${s}&host=${r}`)}},future:{unstable_newEmbeddedAuthStrategy:!0}}),t};let _;function S(a){return _||(_=ne({env:a})),_}function T(a,n){return S(n).authenticate.admin(a)}const le=async({request:a,context:n})=>await S(n.env).authenticate.callback(a),ie=Object.freeze(Object.defineProperty({__proto__:null,loader:le},Symbol.toStringTag,{value:"Module"})),de=async({request:a,context:n})=>{const t=S(n.env);try{console.log("收到 Webhook 请求");const{topic:i,shop:c,webhookId:l}=await t.authenticate.webhook(a);switch(console.log(`处理 webhook: ${i} 来自商店: ${c}, ID: ${l}`),i){case"APP_UNINSTALLED":console.log(`商店 ${c} 卸载了应用，正在清理会话...`);const r=await t.sessionStorage.findSessionsByShop(c);r.length>0?(await t.sessionStorage.deleteSessions(r.map(s=>s.id)),console.log(`已删除 ${r.length} 个会话`)):console.log(`未找到商店 ${c} 的会话`);break;case"ORDERS_CREATE":console.log(`商店 ${c} 创建了新订单`);break;default:console.log(`收到未处理的 webhook 类型: ${i}`)}return new Response(null,{status:200})}catch(i){return console.error("Webhook 处理错误:",i),new Response(null,{status:500})}},ce=Object.freeze(Object.defineProperty({__proto__:null,action:de},Symbol.toStringTag,{value:"Module"})),he=async({request:a,context:n})=>{const{session:t}=await T(a,n.env);return N({message:"欢迎使用 ShopLytix Shopify 应用",shop:t.shop})};function ue(){const{message:a}=k();return o("div",{className:"p-6",children:[e("h1",{className:"text-2xl font-bold mb-4",children:a}),e("p",{className:"mb-4",children:"这是您的 Shopify 应用主页。您可以从这里访问仪表盘和数据分析功能。"}),o("div",{className:"flex space-x-4 mt-6",children:[e(A,{to:"/dashboard",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:"进入仪表盘"}),e(A,{to:"/analytics",className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md",children:"查看数据分析"})]})]})}const me=Object.freeze(Object.defineProperty({__proto__:null,default:ue,loader:he},Symbol.toStringTag,{value:"Module"}));function pe({onMenuClick:a}){return o("header",{className:"h-16 flex items-center justify-between px-4 md:px-6 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[o("div",{className:"flex items-center",children:[o("button",{className:"md:hidden mr-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:a,children:[e("span",{className:"sr-only",children:"打开菜单"}),e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]}),e("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"店铺数据分析"})]}),o("div",{className:"flex items-center space-x-4",children:[o("button",{className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:[e("span",{className:"sr-only",children:"通知"}),e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})]}),e("div",{className:"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-sm font-medium text-gray-700 dark:text-gray-200",children:"WD"})]})]})}function ge({onClose:a}){return o("div",{className:"flex h-full w-64 flex-col bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700",children:[o("div",{className:"flex h-16 items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700",children:[e("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"ShopLytix"}),a&&o("button",{className:"md:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:a,children:[e("span",{className:"sr-only",children:"关闭菜单"}),e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e("nav",{className:"flex-1 overflow-y-auto p-4",children:e("ul",{className:"space-y-2",children:[{name:"仪表盘",href:"/dashboard",icon:"📊"},{name:"数据分析",href:"/analytics",icon:"📈"}].map(t=>e("li",{children:o(H,{to:t.href,onClick:a,className:({isActive:i})=>`flex items-center rounded-md px-3 py-2 text-sm font-medium ${i?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-200":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e("span",{className:"mr-3",children:t.icon}),t.name]})},t.name))})})]})}function M({children:a}){const[n,t]=G(!1);return o("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[n&&e("div",{className:"fixed inset-0 z-20 bg-gray-900 bg-opacity-50 transition-opacity md:hidden",onClick:()=>t(!1)}),e("div",{className:`fixed inset-y-0 left-0 z-30 w-64 transform transition duration-300 ease-in-out md:relative md:translate-x-0 ${n?"translate-x-0":"-translate-x-full"}`,children:e(ge,{onClose:()=>t(!1)})}),o("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e(pe,{onMenuClick:()=>t(!0)}),e("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:a})]})]})}function C({data:a,title:n,height:t=300,color:i="#3b82f6"}){const c=P(null);return j(()=>{if(!c.current)return;const l=c.current,r=l.getContext("2d");if(!r)return;r.clearRect(0,0,l.width,l.height),l.width=l.offsetWidth,l.height=t;const s=40,h=l.width-s*2,g=l.height-s*2,d=Math.max(...a.map(u=>u.value))*1.1;r.beginPath(),r.strokeStyle="#e5e7eb",r.moveTo(s,s),r.lineTo(s,l.height-s),r.lineTo(l.width-s,l.height-s),r.stroke(),r.beginPath(),r.strokeStyle=i,r.lineWidth=2,a.forEach((u,p)=>{const m=s+p/(a.length-1)*h,f=l.height-s-u.value/d*g;p===0?r.moveTo(m,f):r.lineTo(m,f)}),r.stroke(),a.forEach((u,p)=>{const m=s+p/(a.length-1)*h,f=l.height-s-u.value/d*g;r.beginPath(),r.fillStyle=i,r.arc(m,f,4,0,Math.PI*2),r.fill()}),r.fillStyle="#6b7280",r.font="10px sans-serif",r.textAlign="center",a.forEach((u,p)=>{const m=s+p/(a.length-1)*h,f=l.height-s+15;r.fillText(u.label,m,f)})},[a,t,i]),o("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:n}),e("canvas",{ref:c,className:"w-full",height:t})]})}function x({data:a,title:n,height:t=300,color:i="#3b82f6"}){const c=P(null);return j(()=>{if(!c.current)return;const l=c.current,r=l.getContext("2d");if(!r)return;r.clearRect(0,0,l.width,l.height),l.width=l.offsetWidth,l.height=t;const s=40,h=l.width-s*2,g=l.height-s*2,d=Math.max(...a.map(m=>m.value))*1.1;r.beginPath(),r.strokeStyle="#e5e7eb",r.moveTo(s,s),r.lineTo(s,l.height-s),r.lineTo(l.width-s,l.height-s),r.stroke();const u=h/a.length*.8,p=h/a.length*.2;a.forEach((m,f)=>{const b=m.value/d*g,y=s+f*(u+p),v=l.height-s-b;r.fillStyle=i,r.fillRect(y,v,u,b),r.fillStyle="#6b7280",r.font="12px sans-serif",r.textAlign="center",r.fillText(m.value.toString(),y+u/2,v-5),r.fillText(m.label,y+u/2,l.height-s+15)})},[a,t,i]),o("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:n}),e("canvas",{ref:c,className:"w-full",height:t})]})}function L({data:a,title:n,height:t=300}){const i=P(null),c=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#6366f1","#14b8a6","#f97316","#8b5cf6"];return j(()=>{if(!i.current)return;const l=i.current,r=l.getContext("2d");if(!r)return;r.clearRect(0,0,l.width,l.height),l.width=l.offsetWidth,l.height=t;const s=a.reduce((p,m)=>p+m.value,0),h=l.width/2,g=l.height/2,d=Math.min(h,g)-40;let u=0;a.forEach((p,m)=>{const f=p.value/s*2*Math.PI,b=u+f;r.beginPath(),r.moveTo(h,g),r.arc(h,g,d,u,b),r.closePath(),r.fillStyle=p.color||c[m%c.length],r.fill();const y=u+f/2,v=d*1.2,R=h+Math.cos(y)*v,I=g+Math.sin(y)*v;r.beginPath(),r.moveTo(h+Math.cos(y)*d,g+Math.sin(y)*d),r.lineTo(R,I),r.strokeStyle="#9ca3af",r.stroke(),r.fillStyle="#6b7280",r.font="12px sans-serif",r.textAlign=y<Math.PI?"left":"right",r.textBaseline="middle",r.fillText(`${p.label} (${Math.round(p.value/s*100)}%)`,R,I),u=b})},[a,t,c]),o("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:n}),e("canvas",{ref:i,className:"w-full",height:t})]})}async function B(){return{dailySales:[{date:"2023-05-01",amount:1250.75},{date:"2023-05-02",amount:1420.3},{date:"2023-05-03",amount:980.45},{date:"2023-05-04",amount:1560.2},{date:"2023-05-05",amount:1780.9},{date:"2023-05-06",amount:2100.5},{date:"2023-05-07",amount:1890.25}],weeklySales:[{week:"第1周",amount:8950.75},{week:"第2周",amount:9420.3},{week:"第3周",amount:10980.45},{week:"第4周",amount:11560.2}],monthlySales:[{month:"1月",amount:35250.75},{month:"2月",amount:38420.3},{month:"3月",amount:42980.45},{month:"4月",amount:45560.2},{month:"5月",amount:48780.9}],topSellingProducts:[{id:"prod-002",name:"牛仔裤",sales:120},{id:"prod-001",name:"高级T恤",sales:95},{id:"prod-003",name:"运动鞋",sales:85}],salesByCategory:[{category:"服装",sales:15420.5},{category:"鞋类",sales:8750.25},{category:"配饰",sales:4580.75}],customerRetention:68.5,averageOrderCompletion:92.3}}async function D(){return{stockLevels:[{product:"高级T恤",current:100,optimal:120},{product:"牛仔裤",current:75,optimal:80},{product:"运动鞋",current:50,optimal:60}],restockNeeded:[{product:"高级T恤",quantity:20},{product:"运动鞋",quantity:10}],turnoverRate:[{product:"高级T恤",rate:2.5},{product:"牛仔裤",rate:3.2},{product:"运动鞋",rate:2.8}],excessInventory:[{product:"夏季帽子",excess:15,daysInStock:45},{product:"太阳镜",excess:8,daysInStock:38}]}}async function F(){return{newVsReturning:{new:35,returning:65},customerLifetimeValue:2850.75,topCustomers:[{id:"cust-001",name:"张三",totalSpent:4250.5},{id:"cust-002",name:"李四",totalSpent:3780.25},{id:"cust-003",name:"王五",totalSpent:3450.8}],customerSegments:[{segment:"高价值",count:28},{segment:"中等价值",count:45},{segment:"低价值",count:75},{segment:"一次性",count:120}]}}async function fe({request:a}){const n=await B(),t=await D(),i=await F();return N({salesAnalytics:n,inventoryAnalytics:t,customerAnalytics:i})}function ye(){const{salesAnalytics:a,inventoryAnalytics:n,customerAnalytics:t}=k(),i=a.monthlySales.map(d=>({label:d.month,value:d.amount})),c=a.weeklySales.map(d=>({label:d.week,value:d.amount})),l=a.salesByCategory.map(d=>({label:d.category,value:d.sales})),r=n.stockLevels.map(d=>({label:d.product,value:d.current})),s=n.turnoverRate.map(d=>({label:d.product,value:d.rate})),h=t.customerSegments.map(d=>({label:d.segment,value:d.count})),g=t.topCustomers.map(d=>({label:d.name,value:d.totalSpent}));return o(M,{children:[o("div",{className:"mb-6",children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"数据分析"}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"深入分析店铺销售、库存和客户数据"})]}),o("div",{className:"mb-8",children:[e("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"销售分析"}),o("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 mb-6",children:[e(C,{title:"月度销售趋势",data:i}),e(C,{title:"周度销售趋势",data:c,color:"#10b981"})]}),o("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e(L,{title:"各品类销售占比",data:l}),e(x,{title:"热销商品",data:a.topSellingProducts.map(d=>({label:d.name,value:d.sales})),color:"#f59e0b"})]})]}),o("div",{className:"mb-8",children:[e("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"库存分析"}),o("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 mb-6",children:[e(x,{title:"当前库存水平",data:r,color:"#3b82f6"}),e(x,{title:"库存周转率",data:s,color:"#8b5cf6"})]}),o("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e(x,{title:"需要补货的商品",data:n.restockNeeded.map(d=>({label:d.product,value:d.quantity})),color:"#ef4444"}),e(x,{title:"过剩库存",data:n.excessInventory.map(d=>({label:d.product,value:d.excess})),color:"#f97316"})]})]}),o("div",{className:"mb-8",children:[e("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"客户分析"}),o("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 mb-6",children:[e(L,{title:"客户细分",data:h}),e(x,{title:"高价值客户",data:g,color:"#ec4899"})]}),o("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"客户留存与转化"}),o("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[o("div",{children:[e("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"客户留存率"}),o("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.customerRetention,"%"]}),e("div",{className:"mt-1 text-sm text-green-500",children:"↑ 2.5% 相比上月"})]}),o("div",{children:[e("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"订单完成率"}),o("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.averageOrderCompletion,"%"]}),e("div",{className:"mt-1 text-sm text-green-500",children:"↑ 1.2% 相比上月"})]}),o("div",{children:[e("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"新客vs回头客"}),o("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.newVsReturning.new,"% / ",t.newVsReturning.returning,"%"]}),e("div",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"新客户 / 回头客"})]})]})]})]}),o("div",{children:[e("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"综合分析报告"}),o("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"业绩概要"}),e("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:"根据当前数据分析，您的店铺在过去一个月内表现良好，销售额增长了12.5%。热销品类主要集中在服装类， 其中牛仔裤是最畅销的单品。客户留存率保持在较高水平，说明您的产品和服务得到了客户认可。"}),e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 mt-6",children:"改进建议"}),o("ul",{className:"list-disc pl-5 text-gray-700 dark:text-gray-300 space-y-2",children:[e("li",{children:"考虑增加运动鞋的库存，当前库存低于最佳水平"}),e("li",{children:"关注夏季帽子和太阳镜的过剩库存问题，可能需要促销活动"}),e("li",{children:"针对高价值客户群体开展专属营销活动，提高客户忠诚度"}),e("li",{children:"优化商品分类，突出热销品类的展示位置"})]})]})]})]})}const xe=Object.freeze(Object.defineProperty({__proto__:null,default:ye,loader:fe},Symbol.toStringTag,{value:"Module"}));function w({title:a,value:n,icon:t,change:i}){return e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-5",children:o("div",{className:"flex justify-between",children:[o("div",{children:[e("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:a}),e("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white mt-1",children:n}),i&&o("div",{className:"flex items-center mt-2",children:[o("span",{className:`text-sm font-medium ${i.isPositive?"text-green-600":"text-red-600"}`,children:[i.isPositive?"+":"-",Math.abs(i.value),"%"]}),e("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:"vs 上月"})]})]}),e("div",{className:"h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-xl text-blue-600 dark:text-blue-300",children:t})]})})}async function be({request:a}){const n=await B(),t=await D(),i=await F();return N({salesAnalytics:n,inventoryAnalytics:t,customerAnalytics:i})}function ve(){const{salesAnalytics:a,inventoryAnalytics:n,customerAnalytics:t}=k(),i=a.dailySales.map(s=>({label:s.date.split("-")[2],value:s.amount})),c=a.salesByCategory.map(s=>({label:s.category,value:s.sales})),l=a.topSellingProducts.map(s=>({label:s.name,value:s.sales})),r=t.customerSegments.map(s=>({label:s.segment,value:s.count}));return o(M,{children:[o("div",{className:"mb-6",children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"仪表盘"}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"查看您店铺的关键指标和业绩数据"})]}),o("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[e(w,{title:"销售总额",value:`¥${a.monthlySales.reduce((s,h)=>s+h.amount,0).toLocaleString()}`,icon:"💰",change:{value:12.5,isPositive:!0}}),e(w,{title:"客户留存率",value:`${a.customerRetention}%`,icon:"🔄",change:{value:3.7,isPositive:!0}}),e(w,{title:"订单完成率",value:`${a.averageOrderCompletion}%`,icon:"✅",change:{value:1.2,isPositive:!0}}),e(w,{title:"客户终身价值",value:`¥${t.customerLifetimeValue.toLocaleString()}`,icon:"👤"})]}),o("div",{className:"mt-8 grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e(C,{title:"最近7天销售趋势",data:i}),e(x,{title:"各品类销售额",data:c})]}),o("div",{className:"mt-8 grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e(x,{title:"热销商品",data:l,color:"#f59e0b"}),e(L,{title:"客户细分",data:r,color:"#8b5cf6"})]}),o("div",{className:"mt-8 grid grid-cols-1 gap-6 lg:grid-cols-2",children:[o("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"库存状态"}),e("div",{className:"space-y-4",children:n.stockLevels.map((s,h)=>o("div",{className:"flex items-center justify-between",children:[e("span",{className:"text-gray-600 dark:text-gray-400",children:s.product}),o("div",{className:"w-2/3",children:[e("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:e("div",{className:`h-2.5 rounded-full ${s.current/s.optimal<.5?"bg-red-500":s.current/s.optimal<.8?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(100,s.current/s.optimal*100)}%`}})}),o("div",{className:"flex justify-between text-xs mt-1",children:[e("span",{children:s.current}),e("span",{children:s.optimal})]})]})]},h))})]}),o("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"顶级客户"}),e("div",{className:"space-y-4",children:t.topCustomers.map((s,h)=>o("div",{className:"flex items-center justify-between",children:[o("div",{className:"flex items-center",children:[e("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 font-medium",children:s.name.charAt(0)}),e("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:s.name})]}),o("span",{className:"font-medium text-gray-900 dark:text-white",children:["¥",s.totalSpent.toLocaleString()]})]},h))})]})]})]})}const we=Object.freeze(Object.defineProperty({__proto__:null,default:ve,loader:be},Symbol.toStringTag,{value:"Module"})),ke=()=>[{title:"ShopLytix - 店铺数据分析平台"},{name:"description",content:"为您的店铺提供全面的数据分析和可视化服务"}],Ne=async({request:a})=>{const n=new URL(a.url);if(n.searchParams.has("shop")&&n.searchParams.has("host")){const t=n.searchParams.get("shop"),i=n.searchParams.get("host"),c=n.searchParams.get("hmac"),l=n.searchParams.get("timestamp");return Z(`/auth?shop=${t}&host=${i}&hmac=${c}&timestamp=${l}`)}return null};function Se(){return o("div",{className:"flex min-h-screen flex-col",children:[e("header",{className:"bg-white dark:bg-gray-800 shadow",children:o("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8 flex justify-between items-center",children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ShopLytix"}),o("div",{className:"flex items-center space-x-4",children:[e("a",{href:"#",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"功能"}),e("a",{href:"#",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"价格"}),e("a",{href:"#",className:"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"关于我们"})]})]})}),o("main",{className:"flex-grow",children:[e("div",{className:"bg-blue-700 dark:bg-blue-900",children:o("div",{className:"mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8 lg:py-24 text-center",children:[e("h2",{className:"text-4xl font-bold tracking-tight text-white sm:text-5xl",children:"店铺数据分析，一目了然"}),e("p",{className:"mx-auto mt-6 max-w-2xl text-lg text-blue-100",children:"ShopLytix 帮助您深入了解店铺运营数据，优化销售策略，提升业绩表现。"}),e("div",{className:"mt-10 flex justify-center",children:e(A,{to:"/dashboard",className:"rounded-md bg-white px-6 py-3 text-base font-medium text-blue-700 shadow-sm hover:bg-blue-50",children:"进入仪表盘"})})]})}),e("div",{className:"mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8",children:o("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-3",children:[o("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-6 text-center",children:[e("div",{className:"mx-auto h-12 w-12 text-2xl",children:"📊"}),e("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-white",children:"销售数据分析"}),e("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"全面了解销售趋势、热销商品和客户购买行为。"})]}),o("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-6 text-center",children:[e("div",{className:"mx-auto h-12 w-12 text-2xl",children:"📈"}),e("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-white",children:"业绩可视化"}),e("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"直观图表展示业绩指标，帮助您快速做出决策。"})]}),o("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-6 text-center",children:[e("div",{className:"mx-auto h-12 w-12 text-2xl",children:"🔍"}),e("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-white",children:"库存监控"}),e("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"实时监控库存水平，避免缺货或库存积压。"})]})]})})]}),e("footer",{className:"bg-gray-100 dark:bg-gray-800",children:e("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:e("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400",children:"© 2023 ShopLytix. 保留所有权利。"})})})]})}const _e=Object.freeze(Object.defineProperty({__proto__:null,default:Se,loader:Ne,meta:ke},Symbol.toStringTag,{value:"Module"})),Ae=async({request:a,context:n})=>{console.log("Auth 路由被访问:",a.url);try{return await S(n.env).authenticate.admin(a)}catch(t){throw console.error("授权过程中出错:",t),t}},Ce=Object.freeze(Object.defineProperty({__proto__:null,loader:Ae},Symbol.toStringTag,{value:"Module"})),Le=async({request:a,context:n})=>{console.log("App 路由被访问:",a.url);try{const{session:t}=await T(a,n.env),c=new URL(a.url).searchParams.get("host");return N({shop:t.shop,host:c,apiKey:n.env.SHOPIFY_API_KEY})}catch(t){throw console.error("App 路由认证失败:",t),t}};function Pe(){const{shop:a,apiKey:n,host:t}=k();console.log("渲染 App 组件，商店:",a,"host:",t);const i=`
    <script>
      window.shopify = {
        apiKey: "${n}",
        host: "${t||""}",
        shop: "${a}",
        forceRedirect: true
      };
    <\/script>
    <script src="https://cdn.shopify.com/shopifycloud/app-bridge/3.7.7/app-bridge.js" defer><\/script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (window.shopify && window.shopify.host) {
          try {
            var AppBridge = window['app-bridge'];
            var createApp = AppBridge.default;
            var app = createApp({
              apiKey: window.shopify.apiKey,
              host: window.shopify.host,
              forceRedirect: true
            });
            
            // 添加调试信息
            console.log("App Bridge 初始化完成", {
              apiKey: window.shopify.apiKey,
              host: window.shopify.host,
              shop: window.shopify.shop
            });
          } catch (error) {
            console.error("App Bridge 初始化失败:", error);
          }
        } else {
          console.error("shopify 配置对象不存在或 host 为空");
        }
      });
    <\/script>
  `;return o("div",{className:"bg-white dark:bg-gray-900 min-h-screen",children:[e("div",{dangerouslySetInnerHTML:{__html:i}}),e("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:e(O,{})}),e(E,{})]})}const je=Object.freeze(Object.defineProperty({__proto__:null,default:Pe,loader:Le},Symbol.toStringTag,{value:"Module"})),De={entry:{module:"/assets/entry.client-BzMsQKnz.js",imports:["/assets/components--R3fkFE9.js"],css:[]},routes:{root:{id:"root",parentId:void 0,path:"",index:void 0,caseSensitive:void 0,hasAction:!1,hasLoader:!1,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/root-cXFhJFai.js",imports:["/assets/components--R3fkFE9.js"],css:[]},"routes/api.auth.callback":{id:"routes/api.auth.callback",parentId:"root",path:"api/auth/callback",index:void 0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/api.auth.callback-l0sNRNKZ.js",imports:[],css:[]},"routes/api.webhooks":{id:"routes/api.webhooks",parentId:"root",path:"api/webhooks",index:void 0,caseSensitive:void 0,hasAction:!0,hasLoader:!1,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/api.webhooks-l0sNRNKZ.js",imports:[],css:[]},"routes/app._index":{id:"routes/app._index",parentId:"routes/app",path:void 0,index:!0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/app._index-CzRj8XtO.js",imports:["/assets/components--R3fkFE9.js"],css:[]},"routes/analytics":{id:"routes/analytics",parentId:"root",path:"analytics",index:void 0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/analytics-DsIIUhJY.js",imports:["/assets/components--R3fkFE9.js","/assets/PieChart-CVAGs2cB.js"],css:[]},"routes/dashboard":{id:"routes/dashboard",parentId:"root",path:"dashboard",index:void 0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/dashboard-OfyVziuC.js",imports:["/assets/components--R3fkFE9.js","/assets/PieChart-CVAGs2cB.js"],css:[]},"routes/_index":{id:"routes/_index",parentId:"root",path:void 0,index:!0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/_index-CxUI0DOw.js",imports:["/assets/components--R3fkFE9.js"],css:[]},"routes/auth.$":{id:"routes/auth.$",parentId:"root",path:"auth/*",index:void 0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/auth._-l0sNRNKZ.js",imports:[],css:[]},"routes/app":{id:"routes/app",parentId:"root",path:"app",index:void 0,caseSensitive:void 0,hasAction:!1,hasLoader:!0,hasClientAction:!1,hasClientLoader:!1,hasErrorBoundary:!1,module:"/assets/app-CA3LgsK4.js",imports:["/assets/components--R3fkFE9.js"],css:[]}},url:"/assets/manifest-b7ac9aa4.js",version:"b7ac9aa4"},Fe="production",ze="build/client",Ke="/",Ve={v3_fetcherPersist:!0,v3_relativeSplatPath:!0,v3_throwAbortReason:!0,v3_routeConfig:!1,v3_singleFetch:!0,v3_lazyRouteDiscovery:!0,unstable_optimizeDeps:!1},We=!1,Ye="/",He={module:ee},Ue={root:{id:"root",parentId:void 0,path:"",index:void 0,caseSensitive:void 0,module:se},"routes/api.auth.callback":{id:"routes/api.auth.callback",parentId:"root",path:"api/auth/callback",index:void 0,caseSensitive:void 0,module:ie},"routes/api.webhooks":{id:"routes/api.webhooks",parentId:"root",path:"api/webhooks",index:void 0,caseSensitive:void 0,module:ce},"routes/app._index":{id:"routes/app._index",parentId:"routes/app",path:void 0,index:!0,caseSensitive:void 0,module:me},"routes/analytics":{id:"routes/analytics",parentId:"root",path:"analytics",index:void 0,caseSensitive:void 0,module:xe},"routes/dashboard":{id:"routes/dashboard",parentId:"root",path:"dashboard",index:void 0,caseSensitive:void 0,module:we},"routes/_index":{id:"routes/_index",parentId:"root",path:void 0,index:!0,caseSensitive:void 0,module:_e},"routes/auth.$":{id:"routes/auth.$",parentId:"root",path:"auth/*",index:void 0,caseSensitive:void 0,module:Ce},"routes/app":{id:"routes/app",parentId:"root",path:"app",index:void 0,caseSensitive:void 0,module:je}};export{De as assets,ze as assetsBuildDirectory,Ke as basename,He as entry,Ve as future,We as isSpaMode,Fe as mode,Ye as publicPath,Ue as routes};
